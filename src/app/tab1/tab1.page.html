<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title *ngIf="!user">Login</ion-title>
    <ion-title *ngIf="user">Perfil</ion-title>

  </ion-toolbar>
</ion-header>

<ion-content class="login-content">

  <!-- VISTA LOGIN -->
  <div *ngIf="!user" class="login-container">
    <div class="logo-container">
      <div class="logo">
        <ion-icon name="book-notes"></ion-icon>
      </div>
      <h1 class="bienvenido">Bienvenido</h1>
    </div>
    <img class="fotologo" src="..\assets\icono.jpg" alt="logo">

    <form class="credencial">
      <ion-item class="usuario">
        <ion-input type="text" id="usuario" placeholder="Usuario" #usuario required></ion-input>
      </ion-item>

      <ion-item class="contraseña">
        <ion-input [type]="passwordVisible ? 'text' : 'password'" id="password" placeholder="Contraseña" #password
          required>
        </ion-input>
        <ion-icon class="verPassword" slot="end" [name]="passwordVisible ? 'eye-off-outline' : 'eye-outline'"
          (click)="togglePassword()">
        </ion-icon>
      </ion-item>

      <button class="olvidePassword" type="button" (click)="olvidePassword(usuario.value?.toString() || '')">
        Olvidé la contraseña
      </button>
    </form>

    <ion-button class="btn-iniciarSesion" expand="full" fill="clear"
      (click)="iniciarSesion(usuario.value?.toString() || '', password.value?.toString() || '')">
      Iniciar sesión
    </ion-button>

    <div class="aux">
      <span>Inicia sesión con:</span>
    </div>

    <div class="redes">
      <ion-button class="google" fill="clear" (click)="loginConGoogle()">
        <ion-icon slot="start" name="logo-google"></ion-icon>
      </ion-button>

      <ion-button class="gh" fill="clear" (click)="loginConGithub()">
        <ion-icon slot="start" name="logo-github"></ion-icon>
      </ion-button>
    </div>
    <div class="noCuenta-btn">
      <p class="noCuenta">¿No tenés cuenta?</p>
      <ion-button class="btn-registrarse" (click)="irRegistro()" fill="clear">Registrarse</ion-button>
    </div>
  </div>


  <!-- VISTA PERFIL -->
  <div *ngIf="user" class="perfil-container ion-padding">
    <h2>Bienvenido, {{ user.displayName || 'Usuario' }}</h2>

    <ion-avatar>
      <img [src]="user.photoURL" alt="Foto de perfil" />
    </ion-avatar>

    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Nombre:</strong> {{ nombre }}</p>
    <p><strong>Fecha de nacimiento:</strong> {{ fecha }}</p>

    <!-- Botón para desplegar ajustes -->
    <ion-button class="ajustes-button" (click)="toggleAjustes()" fill="clear">
      <ion-icon name="cog-outline"></ion-icon>
    </ion-button>

    <!-- Lista de ajustes colapsable -->
    <ion-list *ngIf="ajustesAbiertos" class="ajustesAbierto">
      <ion-item button (click)="restablecerPassword()">
        <ion-icon slot="start" name="key-outline"></ion-icon>
        <ion-label>Restablecer contraseña</ion-label>
      </ion-item>

      <ion-item button (click)="toggleEditarPerfil()">
        <ion-icon slot="start" name="create-outline"></ion-icon>
        <ion-label>Editar perfil</ion-label>
      </ion-item>

      <ion-item button color="medium" (click)="logout()">
        <ion-icon slot="start" name="exit-outline"></ion-icon>
        <ion-label>Cerrar sesión</ion-label>
      </ion-item>

      <ion-item button color="danger" (click)="eliminarCuenta()">
        <ion-icon slot="start" name="trash-outline"></ion-icon>
        <ion-label>Eliminar cuenta</ion-label>
      </ion-item>

    </ion-list>

    <!-- Formulario de edición de perfil -->
    <ion-card *ngIf="editarPerfilAbierto" class="ion-padding">
      <ion-item>
        <ion-label position="stacked">Nombre</ion-label>
        <ion-input [(ngModel)]="nombre" placeholder="Nombre completo"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Fecha de nacimiento</ion-label>
        <ion-input type="date" [(ngModel)]="fecha"></ion-input>
      </ion-item>

      <ion-button expand="full" (click)="guardarPerfil()">Guardar cambios</ion-button>
      <ion-button expand="full" color="medium" fill="outline" (click)="toggleEditarPerfil()">Cancelar</ion-button>
    </ion-card>

  </div>

</ion-content>